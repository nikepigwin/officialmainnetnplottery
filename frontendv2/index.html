<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="Wed, 30 Jul 2025 12:00:00 GMT">
    <meta name="theme-color" content="#1a2332">
    <meta name="description" content="Decentralized lottery platform on Cardano blockchain">
    <meta name="keywords" content="cardano, lottery, ada, blockchain, decentralized">
    
    <title>NikePig Lottery</title>
    
    <!-- Icons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ°</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ°</text></svg>">
    
    <link rel="stylesheet" href="main.css?v=2.85.0">
    <script src="script.js?v=2.85.0" defer></script>
</head>
<body>
    <div class="container">
        <header class="side-by-side-header">
            <div class="header-content">
                <h1 class="jackpot-header">Cardano Jackpot</h1>
                <h2 class="jackpot-subheader">3 Winners hit the Jackpot daily</h2>
            </div>
        </header>

        <main>
            <!-- Trading Dashboard Section -->
            <section class="card trading-dashboard">
                <div class="dashboard-grid">
                    <!-- Left Column: Pool Info & Timer -->
                    <div class="dashboard-panel pool-info-panel">
                        <!-- Main Pool & Timer Section -->
                        <div class="pool-timer-section">
                            <div class="pool-amount-card">
                                <div class="pool-amount-content">
                                    <div class="pool-amount-label">Total Pool</div>
                                    <div class="pool-tokens-grid">
                                        <div class="token-row">
                                            <div class="token-info">
                                                <img src="img/cardanologo.png" alt="ADA" class="token-logo">
                                                <span class="token-name">ADA</span>
                                            </div>
                                            <div class="token-amount" id="pool-ada-amount">0.00</div>
                                        </div>
                                        <div class="token-row">
                                            <div class="token-info">
                                                <img src="img/SNEKlogo.png" alt="SNEK" class="token-logo">
                                                <span class="token-name">SNEK</span>
                                            </div>
                                            <div class="token-amount" id="pool-snek-amount">0.00</div>
                                        </div>
                                        <div class="token-row">
                                            <div class="token-info">
                                                <img src="img/nikelogo.png" alt="NIKEPIG" class="token-logo">
                                                <span class="token-name">NIKEPIG</span>
                                            </div>
                                            <div class="token-amount" id="pool-nikepig-amount">0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="timer-card">
                                <div class="timer-content">
                                    <div class="timer-label">Time Until Draw</div>
                                    <div class="timer-value" id="countdown-timer-display">Loading...</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Lottery Statistics Section -->
                        <div class="lottery-stats-section">
                            <div class="stats-header">
                                <h4 class="stats-title">Round Statistics</h4>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <img src="img/user.png" alt="Participants" class="stat-icon-image">
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Participants</div>
                                        <div class="stat-value" id="total-participants-display">0</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <img src="img/tickets.png" alt="Total Tickets" class="stat-icon-image">
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Total Tickets</div>
                                        <div class="stat-value" id="total-tickets-display">0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status Row -->
                            <div class="status-row">
                                <div class="status-item">
                                    <span class="status-label">Lottery Status:</span>
                                    <span class="status-value" id="sales-status-display">Open</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">User Tickets:</span>
                                    <span class="status-value" id="user-tickets-display">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Ticket Trading -->
                    <div class="dashboard-panel trading-panel">
                        <div class="trading-header">
                            <!-- Wallet connection moved to right column with ticket buying -->
                            <div class="wallet-connect-section">
                                <div id="wallet-disconnected" class="wallet-status-compact">
                                    <button id="connect-wallet-btn" class="btn btn-primary">Connect Wallet</button>
                                </div>
                                <div id="wallet-connected" class="wallet-status-compact" style="display: none;">
                                    <div class="wallet-address-full" id="wallet-address">e0dd...614f</div>
                                    <button id="disconnectWalletBtn" class="btn btn-secondary">Disconnect</button>
                                </div>
                            </div>
                        </div>

                        <div class="trading-form">
                            <div class="ticket-purchase-form">
                                <!-- Token Selection -->
                                <div class="token-selection">
                                    <label class="form-label">Select Token:</label>
                                    <div class="custom-dropdown">
                                        <div class="dropdown-trigger" id="dropdown-trigger">
                                            <div class="selected-token">
                                                <div class="token-icon">
                                                    <img src="img/cardanologo.png" alt="Cardano" class="token-logo">
                                                </div>
                                                <div class="token-details">
                                                    <div class="token-name">ADA</div>
                                                </div>
                                            </div>
                                            <div class="dropdown-arrow">â–¼</div>
                                        </div>
                                        <div class="dropdown-options" id="dropdown-options">
                                            <!-- Token options will be populated dynamically by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Quantity Selection -->
                            <div class="quantity-controls">
                                    <label class="form-label">Number of Tickets:</label>
                                <div class="quantity-input-group">
                                    <button id="minus-ticket" class="quantity-btn">âˆ’</button>
                                    <input type="number" id="ticket-amount" min="1" value="1" class="quantity-input">
                                    <button id="plus-ticket" class="quantity-btn">+</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="trading-summary">
                                <div class="summary-row">
                                    <span>Quantity:</span>
                                    <span id="summary-quantity">1</span>
                                </div>
                                <div class="summary-row total">
                                    <span>Total Cost:</span>
                                    <span id="ticket-total">5.00 ADA</span>
                                </div>
                            </div>
                            
                            <button id="buy-tickets" class="btn btn-success trading-btn">Buy Tickets</button>
                            
                            <!-- Flash Buy Buttons -->
                            <div class="flash-buy-section">
                                <div class="flash-buy-label">Flash Buy âš¡</div>
                                <div class="flash-buy-buttons">
                                    <button class="flash-buy-btn" data-tickets="10">10 Tickets</button>
                                    <button class="flash-buy-btn" data-tickets="20">20 Tickets</button>
                                    <button class="flash-buy-btn" data-tickets="30">30 Tickets</button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="transactionStatus" class="transaction-status"></div>
                    </div>
                </div>
            </section>







            <!-- Winners Section -->
            <section id="historical-winners-section" class="card-panel">
                <div class="winners-header">
                    <h2 class="section-header">Lottery Winners</h2>
                    <div class="winners-tabs">
                        <button class="winners-tab active" data-tab="weekly">Weekly Results</button>
                        <button class="winners-tab" data-tab="monthly">Monthly Results</button>
                    </div>
                </div>
                
                <!-- Weekly Results Tab Content -->
                <div id="weekly-tab-content" class="winners-tab-content active">
                    <div id="historicalWinnersList"></div>
                </div>
                
                <!-- Monthly Results Tab Content -->
                <div id="monthly-tab-content" class="winners-tab-content">
                    <div class="spreadsheet-header">
                        <div class="spreadsheet-controls">
                            <div class="search-container">
                                <input type="text" id="winners-search" placeholder="Enter wallet address..." class="search-input">
                                <button id="clear-search" class="clear-search-btn">Clear</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="spreadsheet-content" style="width: 100%; max-width: 100%; padding-right: 40px; overflow-x: auto; -webkit-overflow-scrolling: touch; border-radius: 8px; box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);">
                        <table class="winners-table" style="width: 100%; min-width: 100%; border-collapse: collapse; margin: 0; padding: 0;">
                            <thead>
                                <tr>
                                    <th style="background: rgba(135, 206, 235, 0.1); color: #87CEEB; font-weight: 600; font-size: 0.9rem; width: 100%;">Prize Amount</th>
                                    <th style="background: rgba(135, 206, 235, 0.1); color: #87CEEB; font-weight: 600; font-size: 0.9rem; width: 100%;">Winner Address</th>
                                    <th style="background: rgba(135, 206, 235, 0.1); color: #87CEEB; font-weight: 600; font-size: 0.9rem; width: 100%;">Date</th>
                                    <th style="background: rgba(135, 206, 235, 0.1); color: #87CEEB; font-weight: 600; font-size: 0.9rem; width: 100%;">Transaction ID</th>
                                </tr>
                            </thead>
                            <tbody id="winners-table-body">
                                <!-- Winners data will be populated here -->
                            </tbody>
                        </table>
                        <div id="empty-message" class="empty-message" style="display: none;">
                            No winners recorded for this month yet.
                        </div>
                    </div>
                </div>
            </section>

            <!-- Admin Section -->
            <section class="card" id="adminSection" style="display: none;">
                <h2>Admin Controls</h2>
                <div id="adminSectionContent">
                    <p><em>Use these controls to test the lottery cycle</em></p>
                    <div class="admin-controls">
                        <button id="close-round-btn" class="btn btn-warning">Close Round & Select Winners</button>
                        <button id="distribute-prizes-btn" class="btn btn-danger">Distribute Prizes</button>
                        <button id="start-new-round-btn" class="btn btn-success">Start New Round</button>
                        <button id="view-history-btn" class="btn btn-info">View Round History</button>
                        <a href="token-admin.html" class="btn btn-primary">Manage Tokens</a>
                        <button id="initialize-contract-btn" class="btn btn-primary">ðŸš€ Initialize Smart Contract</button>
                    </div>
                    <div id="adminStatus"></div>
                </div>
            </section>
        </main>

        <!-- Footer Section -->
        <footer class="card footer-section">
            <div class="footer-tabs">
                <button class="footer-tab" data-tab="more-info">More Information</button>
                <button class="footer-tab" data-tab="contact-us">Contact Us</button>
            </div>
            <div class="footer-content">
                <div id="more-info-content" class="footer-tab-content">
                    <h3>About Cardano Lottery</h3>
                    <p>The NikePig Lottery is a decentralized platform on the Cardano blockchain, using an off-chain mechanism for automated reward distribution and a provably fair random selection process to determine winners based on ticket odds.</p>
                    <div class="info-slider-container">
                        <div class="info-slider">
                            <div class="info-item">
                                <div class="info-icon">
                                    <img src="img/setting.png" alt="How It Works" class="info-icon-image">
                                </div>
                                <div class="info-content">
                                    <h4>How It Works</h4>
                                    <p>Buy tickets with ADA or native tokens for 5 ADA each. After the countdown, winners are randomly selected, and prizes are automatically sent to your wallet, no manual claiming needed.</p>
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-icon">
                                    <img src="img/chart.png" alt="Prize Distribution" class="info-icon-image">
                                </div>
                                <div class="info-content">
                                    <h4>Prize Distribution</h4>
                                    <p>The total prize pool is divided among three winners: 50% for first place, 30% for second place, and 20% for third place. To sustain the lottery dApp, a 2.5% commission is applied from the total pool.</p>
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-icon">
                                    <img src="img/docs.png" alt="Lottery Winners" class="info-icon-image">
                                </div>
                                <div class="info-content">
                                    <h4>Lottery Winners</h4>
                                    <p>The Lottery dApp is now tracking all winners for the current month! You can view the full history and track records of past draws right here. Press on View all in the Lottery winners section to see Detailed Winners History.</p>
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-icon">
                                    <img src="img/blockchain.png" alt="Transparency" class="info-icon-image">
                                </div>
                                <div class="info-content">
                                    <h4>Transparency</h4>
                                    <p>Recent winners, transactions, and lottery results are securely recorded on the Cardano blockchain for full transparency and verifiability. The smart contract is audited and approved by IOHK.</p>
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-icon">
                                    <img src="img/contract.png" alt="Infrastructure" class="info-icon-image">
                                </div>
                                <div class="info-content">
                                    <h4>Infrastructure</h4>
                                    <p>The lottery uses a smart contract and off-chain processes to select winners, verify tickets, split prizes, and distribute rewards, ensuring a seamless, transparent experience on the Cardano blockchain.</p>
                                </div>
                            </div>
                        </div>
                        <div class="slider-controls">
                            <button class="slider-btn prev-btn" id="info-prev-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <div class="slider-dots" id="info-dots"></div>
                            <button class="slider-btn next-btn" id="info-next-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="contact-us-content" class="footer-tab-content">
                    <h3>Get in Touch</h3>
                    <p>Have questions or need support? We're here to help!</p>
                    <div class="contact-grid">
                        <div class="contact-item">
                            <div class="contact-icon">
                                <img src="img/mail.png" alt="Support" class="contact-icon-image">
                            </div>
                            <div class="contact-content">
                                <h4>Support</h4>
                                <p>For technical support and general inquiries</p>
                                <a href="mailto:support@nikepiglottery.com" class="contact-link">support@nikepiglottery.com</a>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <img src="img/chat.png" alt="Community" class="contact-icon-image">
                            </div>
                            <div class="contact-content">
                                <h4>Community</h4>
                                <p>Join our community discussions</p>
                                <a href="https://discord.com/invite/RPwVazfB2G" target="_blank" class="contact-link">Discord Server</a>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <img src="img/browser.png" alt="Project Links" class="contact-icon-image">
                            </div>
                            <div class="contact-content">
                                <h4>Project Links</h4>
                                <p>Learn more about NikePig</p>
                                <a href="https://linktr.ee/nikepig" target="_blank" class="contact-link">Linktree</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Wallet Selection Modal -->
    <div id="wallet-modal" class="wallet-modal">
        <div class="wallet-modal-content">
            <div class="wallet-modal-header">
                <h3>Choose Your Wallet</h3>
                <button id="close-wallet-modal" class="wallet-modal-close">&times;</button>
            </div>
            <div class="wallet-modal-body">
                <div class="wallet-options">
                    <div class="wallet-option" data-wallet="eternl">
                        <div class="wallet-logo">
                            <img src="img/eternl.png" alt="Eternl" class="wallet-logo-img">
                        </div>
                        <div class="wallet-brand">Eternl</div>
                    </div>
                    <div class="wallet-option" data-wallet="tokeo">
                        <div class="wallet-logo">
                            <img src="img/tokeo.png" alt="Tokeo" class="wallet-logo-img">
                        </div>
                        <div class="wallet-brand">Tokeo</div>
                    </div>
                    <div class="wallet-option" data-wallet="lace">
                        <div class="wallet-logo">
                            <img src="img/lace.png" alt="Lace" class="wallet-logo-img">
                        </div>
                        <div class="wallet-brand">Lace</div>
                    </div>
                    <div class="wallet-option" data-wallet="vespr">
                        <div class="wallet-logo">
                            <img src="img/vespr.png" alt="Vespr" class="wallet-logo-img">
                        </div>
                        <div class="wallet-brand">Vespr</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification element -->
    <div id="notification-container" class="notification-container"></div>
    
    <!-- Spinner -->
    <div id="spinner" class="spinner-overlay" style="display: none;">
        <div class="spinner"></div>
        <p id="spinner-message">Loading...</p>
    </div>

    <!-- Load Lucid from web module and then load app script.js only after Lucid is ready -->
    <script type="module">
      import { Lucid, Blockfrost, Data } from "https://unpkg.com/lucid-cardano@0.10.11/web/mod.js";
      window.Lucid = Lucid;
      window.Blockfrost = Blockfrost;
      Lucid.Data = Data;
      console.log('âœ… Lucid loaded successfully from web module, Data attached');
      // Dynamically load script.js only after Lucid is ready
      const script = document.createElement('script');
              script.src = 'script.js?v=2.26.0';
      document.body.appendChild(script);
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
 