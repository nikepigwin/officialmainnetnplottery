<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1a2332">
    <meta name="description" content="Decentralized lottery platform on Cardano blockchain">
    <meta name="keywords" content="cardano, lottery, ada, blockchain, decentralized">
    
    <title>Nikepig Lottery dApp</title>
    
    <!-- Icons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ°</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ°</text></svg>">
    
    <link rel="stylesheet" href="main.css?v=1.79.0">
</head>
<body>
    <div class="container">
        <header class="side-by-side-header">
            <div class="header-content">
                <h1 class="jackpot-header">Cardano Jackpot</h1>
                <h2 class="jackpot-subheader">3 Winners hit the Jackpot daily</h2>
            </div>
        </header>

        <main>
            <!-- Trading Dashboard Section -->
            <section class="card trading-dashboard">
                <div class="dashboard-grid">
                    <!-- Left Column: Pool Info & Timer -->
                    <div class="dashboard-panel pool-info-panel">
                        <!-- Main Pool & Timer Section -->
                        <div class="pool-timer-section">
                            <div class="pool-amount-card">
                                <div class="pool-amount-content">
                                    <div class="pool-amount-label">Total Pool</div>
                                    <div class="pool-tokens-grid">
                                        <div class="token-row">
                                            <div class="token-info">
                                                <img src="img/cardanologo.png" alt="ADA" class="token-logo">
                                                <span class="token-name">ADA</span>
                                            </div>
                                            <div class="token-amount" id="pool-ada-amount">0.00</div>
                                        </div>
                                        <div class="token-row">
                                            <div class="token-info">
                                                <img src="img/SNEKlogo.png" alt="SNEK" class="token-logo">
                                                <span class="token-name">SNEK</span>
                                            </div>
                                            <div class="token-amount" id="pool-snek-amount">0.00</div>
                                        </div>
                                        <div class="token-row">
                                            <div class="token-info">
                                                <img src="img/nikelogo.png" alt="NIKEPIG" class="token-logo">
                                                <span class="token-name">NIKEPIG</span>
                                            </div>
                                            <div class="token-amount" id="pool-nikepig-amount">0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="timer-card">
                                <div class="timer-content">
                                    <div class="timer-label">Time Until Draw</div>
                                    <div class="timer-value" id="countdown-timer-display">Loading...</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Lottery Statistics Section -->
                        <div class="lottery-stats-section">
                            <div class="stats-header">
                                <h4 class="stats-title">Round Statistics</h4>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <img src="img/user.png" alt="Participants" class="stat-icon-image">
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Participants</div>
                                        <div class="stat-value" id="total-participants-display">0</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <img src="img/tickets.png" alt="Total Tickets" class="stat-icon-image">
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Total Tickets</div>
                                        <div class="stat-value" id="total-tickets-display">0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status Row -->
                            <div class="status-row">
                                <div class="status-item">
                                    <span class="status-label">Lottery Status:</span>
                                    <span class="status-value" id="sales-status-display">Open</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">User Tickets:</span>
                                    <span class="status-value" id="user-tickets-display">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Ticket Trading -->
                    <div class="dashboard-panel trading-panel">
                        <div class="trading-header">
                            <!-- Wallet connection moved to right column with ticket buying -->
                            <div class="wallet-connect-section">
                                <div id="wallet-disconnected" class="wallet-status-compact">
                                    <button id="connect-wallet-btn" class="btn btn-primary">Connect Wallet</button>
                                </div>
                                <div id="wallet-connected" class="wallet-status-compact" style="display: none;">
                                    <div class="wallet-address-full" id="wallet-address">e0dd...614f</div>
                                    <button id="disconnectWalletBtn" class="btn btn-secondary">Disconnect</button>
                                </div>
                            </div>
                        </div>

                        <div class="trading-form">
                            <div class="ticket-purchase-form">
                                <!-- Token Selection -->
                                <div class="token-selection">
                                    <label class="form-label">Select Token:</label>
                                    <div class="custom-dropdown">
                                        <div class="dropdown-trigger" id="dropdown-trigger">
                                            <div class="selected-token">
                                                <div class="token-icon">
                                                    <img src="img/cardanologo.png" alt="Cardano" class="token-logo">
                                                </div>
                                                <div class="token-details">
                                                    <div class="token-name">ADA</div>
                                                </div>
                                            </div>
                                            <div class="dropdown-arrow">â–¼</div>
                                        </div>
                                        <div class="dropdown-options" id="dropdown-options">
                                            <!-- Token options will be populated dynamically by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Quantity Selection -->
                            <div class="quantity-controls">
                                    <label class="form-label">Number of Tickets:</label>
                                <div class="quantity-input-group">
                                    <button id="minus-ticket" class="quantity-btn">âˆ’</button>
                                    <input type="number" id="ticket-amount" min="1" max="100" value="1" class="quantity-input">
                                    <button id="plus-ticket" class="quantity-btn">+</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="trading-summary">
                                <div class="summary-row">
                                    <span>Quantity:</span>
                                    <span id="summary-quantity">1</span>
                                </div>
                                <div class="summary-row total">
                                    <span>Total Cost:</span>
                                    <span id="ticket-total">5.00 ADA</span>
                                </div>
                            </div>
                            
                            <button id="buy-tickets" class="btn btn-success trading-btn">Buy Tickets</button>
                            
                            <!-- Flash Buy Buttons -->
                            <div class="flash-buy-section">
                                <div class="flash-buy-label">Flash Buy âš¡</div>
                                <div class="flash-buy-buttons">
                                    <button class="flash-buy-btn" data-tickets="10">10 Tickets</button>
                                    <button class="flash-buy-btn" data-tickets="20">20 Tickets</button>
                                    <button class="flash-buy-btn" data-tickets="30">30 Tickets</button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="transactionStatus" class="transaction-status"></div>
                    </div>
                </div>
            </section>







            <!-- Winners Section -->
            <section id="historical-winners-section" class="card-panel">
                <h2 class="section-header">Lottery Winners</h2>
                <div id="historicalWinnersList"></div>
            </section>

            <!-- Admin Section -->
            <section class="card" id="adminSection" style="display: none;">
                <h2>Admin Controls</h2>
                <div id="adminSectionContent">
                    <p><em>Use these controls to test the lottery cycle</em></p>
                    <div class="admin-controls">
                        <button id="close-round-btn" class="btn btn-warning">Close Round & Select Winners</button>
                        <button id="distribute-prizes-btn" class="btn btn-danger">Distribute Prizes</button>
                        <button id="start-new-round-btn" class="btn btn-success">Start New Round</button>
                        <button id="view-history-btn" class="btn btn-info">View Round History</button>
                        <a href="token-admin.html" class="btn btn-primary">Manage Tokens</a>
                        <button id="initialize-contract-btn" class="btn btn-primary">ðŸš€ Initialize Smart Contract</button>
                    </div>
                    <div id="adminStatus"></div>
                </div>
            </section>
        </main>

        <!-- Footer Section -->
        <footer class="card footer-section">
            <div class="footer-tabs">
                <button class="footer-tab" data-tab="more-info">More Information</button>
                <button class="footer-tab" data-tab="contact-us">Contact Us</button>
            </div>
            <div class="footer-content">
                <div id="more-info-content" class="footer-tab-content">
                    <h3>About Cardano Lottery</h3>
                    <p>The NikePig Lottery is a decentralized platform on the Cardano blockchain, using an off-chain mechanism for automated reward distribution and a provably fair random selection process to determine winners based on ticket odds.</p>
                    <div class="info-grid">
                        <div class="info-item">
                            <h4>How It Works</h4>
                            <p>Buy tickets with ADA or native tokens for 5 ADA each. After the countdown, winners are randomly selected, and prizes are automatically sent to your wallet, no manual claiming needed.</p>
                        </div>
                        <div class="info-item">
                            <h4>Prize Distribution</h4>
                            <p>The total prize pool is divided among three winners: 50% for first place, 30% for second place, and 20% for third place. To sustain the lottery dApp, a 5% commission is applied from the total pool.</p>
                        </div>
                        <div class="info-item">
                            <h4>Transparency</h4>
                            <p>Recent winners, transactions, and lottery results are securely recorded on the Cardano blockchain for full transparency and verifiability. The smart contract is audited and approved by IOHK.</p>
                        </div>
                        <div class="info-item">
                            <h4>Infrastructure</h4>
                            <p>The lottery uses a smart contract and off-chain processes to select winners, verify tickets, split prizes, and distribute rewards, ensuring a seamless, transparent experience on the Cardano blockchain.</p>
                        </div>
                    </div>
                </div>
                <div id="contact-us-content" class="footer-tab-content">
                    <h3>Get in Touch</h3>
                    <p>Have questions or need support? We're here to help!</p>
                    <div class="contact-grid">
                        <div class="contact-item">
                            <h4>Support</h4>
                            <p>For technical support and general inquiries</p>
                            <a href="mailto:support@nikepiglottery.com" class="contact-link">support@nikepiglottery.com</a>
                        </div>
                        <div class="contact-item">
                            <h4>Community</h4>
                            <p>Join our community discussions</p>
                            <a href="https://discord.com/invite/RPwVazfB2G" target="_blank" class="contact-link">Discord Server</a>
                        </div>
                        <div class="contact-item">
                            <h4>Documentation</h4>
                            <p>Learn more about the lottery system</p>
                            <a href="#" class="contact-link">Read Documentation</a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Notification element -->
    <div id="notification-container" class="notification-container"></div>
    
    <!-- Spinner -->
    <div id="spinner" class="spinner-overlay" style="display: none;">
        <div class="spinner"></div>
        <p id="spinner-message">Loading...</p>
    </div>

    <!-- Load Lucid from web module and then load app script.js only after Lucid is ready -->
    <script type="module">
      import { Lucid, Blockfrost, Data } from "https://unpkg.com/lucid-cardano@0.10.11/web/mod.js";
      window.Lucid = Lucid;
      window.Blockfrost = Blockfrost;
      Lucid.Data = Data;
      console.log('âœ… Lucid loaded successfully from web module, Data attached');
      // Dynamically load script.js only after Lucid is ready
      const script = document.createElement('script');
      script.src = 'script.js?v=1.79.0';
      document.body.appendChild(script);
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
 